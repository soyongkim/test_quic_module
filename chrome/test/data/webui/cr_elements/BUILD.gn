# Copyright 2019 The Chromium Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

import("//build/config/chromeos/ui_mode.gni")
import("//third_party/closure_compiler/closure_args.gni")
import("//third_party/closure_compiler/compile_js.gni")
import("//tools/typescript/ts_library.gni")
import("//ui/webui/resources/tools/generate_grd.gni")
import("../namespace_rewrites.gni")

js_type_check("closure_compile") {
  is_polymer3 = true
  closure_flags = default_closure_args + [
                    "js_module_root=../../chrome/test/data/webui/",
                    "js_module_root=./gen/chrome/test/data/webui/",
                  ]

  deps = [
    ":cr_card_radio_button_test",
    ":cr_container_shadow_behavior_test",
    ":cr_fingerprint_progress_arc_tests",
    ":cr_grid_focus_test",
    ":cr_icon_button_tests",
    ":cr_input_test",
    ":cr_lottie_tests",
    ":cr_policy_indicator_behavior_tests",
    ":cr_policy_indicator_tests",
    ":cr_policy_pref_indicator_tests",
    ":cr_policy_strings",
    ":cr_profile_avatar_selector_tests",
    ":cr_scrollable_behavior_tests",
    ":cr_splitter_test",
    ":cr_toast_manager_test",
    ":cr_toast_test",
    ":cr_toolbar_focus_tests",
    ":iron_list_focus_test",
  ]

  if (is_chromeos_ash) {
    deps += [ ":cr_searchable_drop_down_tests" ]
  }
}

js_library("cr_container_shadow_behavior_test") {
  deps = [
    "..:chai_assert",
    "//third_party/polymer/v3_0/components-chromium/polymer:polymer_bundled",
    "//ui/webui/resources/cr_elements:cr_container_shadow_behavior.m",
  ]
  externs_list = [ "$externs_path/mocha-2.5.js" ]
}

js_library("cr_fingerprint_progress_arc_tests") {
  deps = [
    "..:chai_assert",
    "..:mock_controller",
    "//third_party/polymer/v3_0/components-chromium/polymer:polymer_bundled",
    "//ui/webui/resources/cr_elements/cr_fingerprint:cr_fingerprint_progress_arc.m",
    "//ui/webui/resources/cr_elements/cr_lottie:cr_lottie.m",
  ]
  externs_list = [ "$externs_path/mocha-2.5.js" ]
}

js_library("cr_icon_button_tests") {
  deps = [
    "..:chai_assert",
    "..:test_util",
    "//third_party/polymer/v3_0/components-chromium/iron-test-helpers:mock-interactions",
    "//ui/webui/resources/cr_elements/cr_icon_button:cr_icon_button.m",
  ]
  externs_list = [ "$externs_path/mocha-2.5.js" ]
}

js_library("cr_input_test") {
  deps = [
    "..:chai_assert",
    "..:test_util",
    "//third_party/polymer/v3_0/components-chromium/polymer:polymer_bundled",
    "//ui/webui/resources/cr_elements/cr_input:cr_input.m",
  ]
  externs_list = [ "$externs_path/mocha-2.5.js" ]
}

js_library("cr_grid_focus_test") {
  deps = [
    "..:chai_assert",
    "..:test_util",
    "//third_party/polymer/v3_0/components-chromium/iron-test-helpers:mock-interactions",
    "//ui/webui/resources/cr_elements/cr_grid",
    "//ui/webui/resources/js:util.m",
  ]
  externs_list = [ "$externs_path/mocha-2.5.js" ]
}

js_library("cr_lottie_tests") {
  deps = [
    "..:chai_assert",
    "..:mock_controller",
    "//ui/webui/resources/cr_elements/cr_lottie:cr_lottie.m",
  ]
  externs_list = [ "$externs_path/mocha-2.5.js" ]
}

js_library("cr_policy_indicator_behavior_tests") {
  deps = [
    "..:chai_assert",
    "//third_party/polymer/v3_0/components-chromium/polymer:polymer_bundled",
    "//ui/webui/resources/cr_elements/policy:cr_policy_indicator_behavior.m",
    "//ui/webui/resources/js:cr.m",
  ]
  externs_list = [ "$externs_path/mocha-2.5.js" ]
}

js_library("cr_policy_indicator_tests") {
  deps = [
    "..:chai_assert",
    "//ui/webui/resources/cr_elements/policy:cr_policy_indicator.m",
    "//ui/webui/resources/cr_elements/policy:cr_policy_indicator_behavior.m",
    "//ui/webui/resources/cr_elements/policy:cr_tooltip_icon.m",
    "//ui/webui/resources/js:cr.m",
  ]
  externs_list = [ "$externs_path/mocha-2.5.js" ]
}

js_library("cr_policy_pref_indicator_tests") {
  deps = [
    ":cr_policy_strings",
    "..:chai_assert",
    "//third_party/polymer/v3_0/components-chromium/polymer:polymer_bundled",
    "//ui/webui/resources/cr_elements/policy:cr_policy_pref_indicator.m",
    "//ui/webui/resources/cr_elements/policy:cr_tooltip_icon.m",
  ]
  externs_list = [ "$externs_path/mocha-2.5.js" ]
}

js_library("cr_policy_strings") {
}

js_library("cr_profile_avatar_selector_tests") {
  deps = [
    "..:chai_assert",
    "//third_party/polymer/v3_0/components-chromium/iron-test-helpers:mock-interactions",
    "//third_party/polymer/v3_0/components-chromium/polymer:polymer_bundled",
    "//ui/webui/resources/cr_elements/cr_profile_avatar_selector:cr_profile_avatar_selector",
    "//ui/webui/resources/js:util.m",
  ]
  externs_list = [ "$externs_path/mocha-2.5.js" ]
}

js_library("cr_card_radio_button_test") {
  deps = [
    "..:chai_assert",
    "//ui/webui/resources/cr_elements/cr_radio_button:cr_card_radio_button.m",
  ]
  externs_list = [ "$externs_path/mocha-2.5.js" ]
}

js_library("cr_scrollable_behavior_tests") {
  deps = [
    "..:chai_assert",
    "..:test_util",
    "//third_party/polymer/v3_0/components-chromium/iron-list:iron-list",
    "//third_party/polymer/v3_0/components-chromium/polymer:polymer_bundled",
    "//ui/webui/resources/cr_elements:cr_scrollable_behavior.m",
  ]
  externs_list = [ "$externs_path/mocha-2.5.js" ]
}

js_library("cr_splitter_test") {
  deps = [
    "..:chai_assert",
    "//ui/webui/resources/cr_elements/cr_splitter:cr_splitter",
  ]
  externs_list = [ "$externs_path/mocha-2.5.js" ]
}

js_library("cr_toast_manager_test") {
  deps = [
    "..:chai_assert",
    "..:test_util",
    "//ui/webui/resources/cr_elements/cr_toast:cr_toast",
    "//ui/webui/resources/cr_elements/cr_toast:cr_toast_manager",
  ]
  externs_list = [ "$externs_path/mocha-2.5.js" ]
}

js_library("cr_toast_test") {
  deps = [
    "..:chai_assert",
    "..:mock_timer",
    "//ui/webui/resources/cr_elements/cr_toast:cr_toast",
  ]
  externs_list = [ "$externs_path/mocha-2.5.js" ]
}

js_library("cr_toolbar_focus_tests") {
  deps = [
    "..:chai_assert",
    "..:test_util",
    "//third_party/polymer/v3_0/components-chromium/polymer:polymer_bundled",
    "//ui/webui/resources/cr_elements/cr_toolbar:cr_toolbar",
  ]
  externs_list = [ "$externs_path/mocha-2.5.js" ]
}

js_library("iron_list_focus_test") {
  deps = [
    "..:chai_assert",
    "//third_party/polymer/v3_0/components-chromium/iron-list:iron-list",
    "//third_party/polymer/v3_0/components-chromium/polymer:polymer_bundled",
  ]
  externs_list = [ "$externs_path/mocha-2.5.js" ]
}

if (is_chromeos_ash) {
  js_library("cr_searchable_drop_down_tests") {
    deps = [
      "..:chai_assert",
      "//third_party/polymer/v3_0/components-chromium/iron-test-helpers:mock-interactions",
      "//ui/webui/resources/cr_elements/cr_input:cr_input.m",
      "//ui/webui/resources/cr_elements/cr_searchable_drop_down:cr_searchable_drop_down",
    ]
    externs_list = [ "$externs_path/mocha-2.5.js" ]
  }
}

generate_grd("build_grdp") {
  grd_prefix = "webui_cr_elements"
  out_grd = "$target_gen_dir/resources.grdp"

  deps = [ ":build_ts" ]
  manifest_files = [ "$target_gen_dir/tsconfig.manifest" ]
  resource_path_prefix = "cr_elements"
}

ts_library("build_ts") {
  root_dir = "."
  out_dir = "$target_gen_dir/tsc"
  tsconfig_base = "tsconfig_base.json"
  path_mappings = [ "chrome://webui-test/*|" +
                    rebase_path("$root_gen_dir/chrome/test/data/webui/tsc/*",
                                target_gen_dir) ]
  in_files = [
    "cr_action_menu_test.ts",
    "cr_auto_img_test.ts",
    "cr_button_tests.ts",
    "cr_checkbox_test.ts",
    "cr_dialog_test.ts",
    "cr_drawer_tests.ts",
    "cr_expand_button_tests.ts",
    "cr_lazy_render_tests.ts",
    "cr_link_row_tests.ts",
    "cr_radio_group_test.ts",
    "cr_radio_button_test.ts",
    "cr_search_field_tests.ts",
    "cr_slider_test.ts",
    "cr_tabs_test.ts",
    "cr_toggle_test.ts",
    "cr_toolbar_search_field_tests.ts",
    "cr_toolbar_test.ts",
    "cr_view_manager_test.ts",
  ]
  deps = [ "//ui/webui/resources:library" ]
  extra_deps = [ "..:generate_definitions" ]
}
